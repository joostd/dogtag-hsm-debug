sudo systemctl start pki-tomcatd@pki-tomcat.service

sudo systemctl start dirsrv.target

sudo certutil -d /etc/pki/pki-tomcat/alias -L

sudo pki -d /etc/pki/pki-tomcat/alias nss-cert-show sslserver


openssl pkcs12 -in /root/.dogtag/pki-tomcat/ca_admin_cert.p12

sudo certutil -d .dogtag/pki-tomcat/ca/alias -L
sudo pki -d /root/.dogtag/pki-tomcat/ca/alias nss-cert-show caadmin

pk12util -i /root/.dogtag/pki-tomcat/ca_admin_cert.p12 -d .dogtag/nssdb -W Secret.123

###### OR

# https://github.com/dogtagpki/pki/blob/DOGTAG_10_6_BRANCH/docs/installation/Installing_CA.md
python3 -c 'import socket; print(socket.getfqdn())'
pki -c Secret.123 client-init
pki -c Secret.123 client-cert-import  --pkcs12 ~/.dogtag/pki-tomcat/ca_admin_cert.p12  --pkcs12-password-file ~/.dogtag/pki-tomcat/ca/pkcs12_password.conf
certutil -L -d /root/.dogtag/nssdb/
pki -c Secret.123 -n caadmin ca-user-show caadmin

##### END

pki -U https://ubuntu-jammy:8443/ -d .dogtag/nssdb -n caadmin ca-profile-find
pki -d .dogtag/nssdb -n caadmin ca-profile-find

curl -k https://ubuntu-jammy:8443/ca/admin/ca/getStatus

pki -d .dogtag/nssdb -n caadmin ca-cert-find
pki -d .dogtag/nssdb -n caadmin ca-cert-find --name "CA Signing Certificate"
pki -d .dogtag/nssdb -n caadmin ca-cert-find --name "ubuntu-jammy"

# show profile for Manual Certificate Manager Signing Certificate Enrollment

pki -d .dogtag/nssdb -n caadmin ca-profile-show caCACert

####### ISSUING ######


openssl genrsa -out /tmp/key.pem 
openssl req -new -key /tmp/key.pem -subj '/CN=test' -out /tmp/csr.pem

pki -d .dogtag/nssdb -n caadmin ca-cert-request-profile-show caCACert --output template.xml

apt install xsltproc jq
xsltproc --stringparam csr "$(cat /tmp/csr.pem)" template.xslt template.xml > request.xml


# pki -d .dogtag/nssdb -n caadmin ca-cert-request-submit request.xml 
-----------------------------
Submitted certificate request
-----------------------------
  Request ID: 11
  Type: enrollment
  Request Status: pending
  Operation Result: success


# pki -d .dogtag/nssdb -n caadmin ca-cert-request-approve 11
  Request ID: 11
  Profile: Manual Certificate Manager Signing Certificate Enrollment
  Type: enrollment
  Status: pending

  Certificate Request Input:
    cert_request_type: pkcs10
    cert_request: -----BEGIN CERTIFICATE REQUEST-----
MIICVDCCATwCAQAwDzENMAsGA1UEAwwEdGVzdDCCASIwDQYJKoZIhvcNAQEBBQAD
ggEPADCCAQoCggEBAL6fSzZIqDYaz+O4WamobixapcoALtNqz1sglijmTHd4CsAr
PpqKRyiar4+Q6DlfF1cMVLoenpVUCjuqu0oUet+D0ckoAbbzPpxA7UN2VQyP4wqG
4k2Hf0FJCmswiJvR2Dfvlx7wjNKBTpZrQSGl2MDXNzumnM8lACyhYiCkAwnBxg9m
GLBC0K2h0G/hovWnzGQbWXtviDK18DnQocINSS4NZK/oMB86nhGPavPwdYJ5wk6Y
hWUP0vUns5Z39hutASn8KNi0a06++bXsCqNiLwXf2/boseU9daqrxXXD/a3HV+Ii
XIs/ouLamp6LSf8gWZ6lyi7BnBUitFgnThjZG2MCAwEAAaAAMA0GCSqGSIb3DQEB
CwUAA4IBAQBumRmYdQ7heGzZ+w8fm5zzojNUY2gqVOeMpVPIL6VHdWPfTe/Fv22R
LSWFI/WwAM+eAE7JWywjEx3x/3ULmUAYqOJesv6lE0UXoYHwWgbkP+h8mPZJcu6f
MJatAX9OSoom7vfcBQI5YvJ9gyfTFxtYU6uB0I7iTtE/aeOgGrejVHiF/fO5jKA1
8SMMysbuWsFRTB2OMbr0qrriebcQPjW1pne32UqNf7x30K9WBZGi6h1vJFxZWCPA
DY7cqGtiLy/b5IsmbQX6nFnIDdC2hmani+yhVhdpgwINGcQ7p7LHrftdVeQ+0Itt
oeeQpjhubCvoWUlj/n5SsewPPphZX01g
-----END CERTIFICATE REQUEST-----

  Requestor Information:
    none

Are you sure (y/N)? y
-------------------------------
Approved certificate request 11
-------------------------------
  Request ID: 11
  Type: enrollment
  Request Status: complete
  Operation Result: success
  Certificate ID: 0x7

# pki -d .dogtag/nssdb -n caadmin ca-cert-find --name test
---------------
1 entries found
---------------
  Serial Number: 0x7
  Subject DN: CN=test
  Issuer DN: CN=CA Signing Certificate,OU=pki-tomcat,O=EXAMPLE
  Status: VALID
  Type: X.509 version 3
  Key Algorithm: PKCS #1 RSA with 2048-bit key
  Not Valid Before: Fri Feb 24 09:03:12 UTC 2023
  Not Valid After: Tue Feb 24 07:48:16 UTC 2043
  Issued On: Fri Feb 24 09:08:09 UTC 2023
  Issued By: caadmin
----------------------------
Number of entries returned 1
----------------------------


pki -d .dogtag/nssdb -n caadmin ca-cert-export 0x7 | openssl x509  -noout -text

